{"version":3,"names":["_url","_interopRequireDefault","require","_sha","_webexPlugin","_metrics","_serviceCatalog","_serviceRegistry","_serviceState","_serviceFedRamp","ownKeys","object","enumerableOnly","keys","_Object$keys2","_Object$getOwnPropertySymbols","symbols","filter","sym","_Object$getOwnPropertyDescriptor","enumerable","push","apply","_objectSpread","target","i","arguments","length","source","Object","forEach","key","_defineProperty2","default","_Object$getOwnPropertyDescriptors","_Object$defineProperties","_Object$defineProperty","trailingSlashes","Services","WebexPlugin","extend","namespace","registries","_weakMap","states","props","validateDomains","_catalogs","_serviceUrls","getRegistry","get","webex","getState","_getCatalog","name","priorityHost","serviceGroup","catalog","hasService","serviceName","hasAllowedDomains","getAllowedDomains","list","markFailedUrl","url","noPriorityHosts","_updateServiceUrls","serviceUrls","updateServices","_this","_ref","undefined","from","query","token","forceRefresh","formattedQuery","status","collecting","waitForCatalog","queryKey","_keys","includes","_promise","reject","Error","email","emailhash","sha256","toLowerCase","toString","_fetchNewServiceHostmap","then","serviceHostMap","updateServiceUrls","updateCredentialsConfig","catch","error","validateUser","_ref2","_this2","_ref2$reqId","reqId","_ref2$forceRefresh","_ref2$activationOptio","activationOptions","preloginUserId","logger","info","canAuthorize","credentials","getUserToken","sendUserActivation","userObj","activated","exists","details","user","_this$webex$credentia","config","client_id","client_secret","collectPreauthCatalog","idbrokerService","getClientToken","uri","concat","scope","tokenObj","collectSigninCatalog","rto","all","_ref3","_ref4","_slicedToArray2","response","statusCode","responseText","body","message","getMeetingPreferences","_this3","request","method","service","resource","res","err","fetchClientRegionInfo","_this4","addAuthHeader","headers","timeout","_ref5","_this5","countryCode","timezone","clientRegionInfo","accept","authorization","timeZone","shouldRefreshAccessToken","_ref6","mode","_ref7","_this$list","idbroker","identity","_this$webex$config$cr","authorizationString","authorizeUrl","replace","setConfig","supertoken","access_token","postauth","ready","preauth","initServiceCatalogs","waitForService","_ref8","_this6","_ref8$timeout","services","fetchFromServiceUrl","servicesNotNeedValidation","find","resolve","priorityUrl","priorityUrlObj","getServiceFromUrl","isReady","internal","metrics","submitClientMetrics","METRICS","JS_SDK_SERVICE_NOT_FOUND","fields","service_name","groupsToCheck","checkCatalog","catalogGroup","scopedPriorityUrl","scopedPrioriryUrlObj","map","group","_formatReceivedHostmap","serviceHostmap","formattedHostmap","hostCatalog","reduce","accumulator","_serviceItem$hosts","id","split","defaultUrl","serviceLinks","serviceItem","item","defaultHost","Url","parse","hostname","hosts","host","ttl","priority","homeCluster","_toConsumableArray2","getClusterId","findClusterId","getServiceFromClusterId","params","findServiceFromClusterId","findServiceUrlFromUrl","isServiceUrl","isAllowedDomainUrl","findAllowedDomain","convertUrlToPriorityHostUrl","data","_this7","_ref9","qs","format","timestamp","Date","getTime","requestObject","_ref10","initConfig","_this$webex$config","fedramp","discovery","fedRampServices","formattedDiscoveryServices","override","formattedOverrideServices","allowedDomains","setAllowedDomains","_this8","getOrgId","orgId","warn","initialize","_this9","ServiceCatalog","registry","ServiceRegistry","state","ServiceState","set","listenToOnce","version","_default","exports"],"sources":["services.js"],"sourcesContent":["import Url from 'url';\n\nimport sha256 from 'crypto-js/sha256';\n\nimport WebexPlugin from '../webex-plugin';\n\nimport METRICS from './metrics';\nimport ServiceCatalog from './service-catalog';\nimport ServiceRegistry from './service-registry';\nimport ServiceState from './service-state';\nimport fedRampServices from './service-fed-ramp';\n\nconst trailingSlashes = /(?:^\\/)|(?:\\/$)/;\n\n/* eslint-disable no-underscore-dangle */\n/**\n * @class\n */\nconst Services = WebexPlugin.extend({\n  namespace: 'Services',\n\n  /**\n   * The {@link WeakMap} of {@link ServiceRegistry} class instances that are\n   * keyed with WebexCore instances.\n   *\n   * @instance\n   * @type {WeakMap<WebexCore, ServiceRegistry>}\n   * @private\n   * @memberof Services\n   */\n  registries: new WeakMap(),\n\n  /**\n   * The {@link WeakMap} of {@link ServiceState} class instances that are\n   * keyed with WebexCore instances.\n   *\n   * @instance\n   * @type {WeakMap<WebexCore, ServiceState>}\n   * @private\n   * @memberof Services\n   */\n  states: new WeakMap(),\n\n  props: {\n    validateDomains: ['boolean', false, true],\n  },\n\n  _catalogs: new WeakMap(),\n\n  _serviceUrls: null,\n\n  /**\n   * Get the registry associated with this webex instance.\n   *\n   * @private\n   * @memberof Services\n   * @returns {ServiceRegistry} - The associated {@link ServiceRegistry}.\n   */\n  getRegistry() {\n    return this.registries.get(this.webex);\n  },\n\n  /**\n   * Get the state associated with this webex instance.\n   *\n   * @private\n   * @memberof Services\n   * @returns {ServiceState} - The associated {@link ServiceState}.\n   */\n  getState() {\n    return this.states.get(this.webex);\n  },\n\n  /**\n   * @private\n   * Get the current catalog based on the assocaited\n   * webex instance.\n   * @returns {ServiceCatalog}\n   */\n  _getCatalog() {\n    return this._catalogs.get(this.webex);\n  },\n\n  /**\n   * Get a service url from the current services list by name\n   * from the associated instance catalog.\n   * @param {string} name\n   * @param {boolean} [priorityHost]\n   * @param {string} [serviceGroup]\n   * @returns {string|undefined}\n   */\n  get(name, priorityHost, serviceGroup) {\n    const catalog = this._getCatalog();\n\n    return catalog.get(name, priorityHost, serviceGroup);\n  },\n\n  /**\n   * Determine if the catalog contains a specific service\n   *\n   * @param {string} serviceName - The service name to validate.\n   * @returns {boolean} - True if the service exists.\n   */\n  hasService(serviceName) {\n    return !!this.get(serviceName);\n  },\n\n  /**\n   * Determine if a whilelist exists in the service catalog.\n   *\n   * @returns {boolean} - True if a allowed domains list exists.\n   */\n  hasAllowedDomains() {\n    const catalog = this._getCatalog();\n\n    return catalog.getAllowedDomains().length > 0;\n  },\n\n  /**\n   * Generate a service catalog as an object from\n   * the associated instance catalog.\n   * @param {boolean} [priorityHost] - use highest priority host if set to `true`\n   * @param {string} [serviceGroup]\n   * @returns {Record<string, string>}\n   */\n  list(priorityHost, serviceGroup) {\n    const catalog = this._getCatalog();\n\n    return catalog.list(priorityHost, serviceGroup);\n  },\n\n  /**\n   * Mark a priority host service url as failed.\n   * This will mark the host associated with the\n   * `ServiceUrl` to be removed from the its\n   * respective host array, and then return the next\n   * viable host from the `ServiceUrls` host array,\n   * or the `ServiceUrls` default url if no other priority\n   * hosts are available, or if `noPriorityHosts` is set to\n   * `true`.\n   * @param {string} url\n   * @param {boolean} noPriorityHosts\n   * @returns {string}\n   */\n  markFailedUrl(url, noPriorityHosts) {\n    const catalog = this._getCatalog();\n\n    return catalog.markFailedUrl(url, noPriorityHosts);\n  },\n\n  /**\n   * saves all the services from the pre and post catalog service\n   * @param {Object} serviceUrls\n   * @returns {void}\n   */\n  _updateServiceUrls(serviceUrls) {\n    this._serviceUrls = {...this._serviceUrls, ...serviceUrls};\n  },\n\n  /**\n   * Update a list of `serviceUrls` to the most current\n   * catalog via the defined `discoveryUrl` then returns the current\n   * list of services.\n   * @param {object} [param]\n   * @param {string} [param.from] - This accepts `limited` or `signin`\n   * @param {object} [param.query] - This accepts `email`, `orgId` or `userId` key values\n   * @param {string} [param.query.email] - must be a standard-format email\n   * @param {string} [param.query.orgId] - must be an organization id\n   * @param {string} [param.query.userId] - must be a user id\n   * @param {string} [param.token] - used for signin catalog\n   * @returns {Promise<object>}\n   */\n  updateServices({from, query, token, forceRefresh} = {}) {\n    const catalog = this._getCatalog();\n    let formattedQuery;\n    let serviceGroup;\n\n    // map catalog name to service group name.\n    switch (from) {\n      case 'limited':\n        serviceGroup = 'preauth';\n        break;\n      case 'signin':\n        serviceGroup = 'signin';\n        break;\n      default:\n        serviceGroup = 'postauth';\n        break;\n    }\n\n    // confirm catalog update for group is not in progress.\n    if (catalog.status[serviceGroup].collecting) {\n      return this.waitForCatalog(serviceGroup);\n    }\n\n    catalog.status[serviceGroup].collecting = true;\n\n    if (serviceGroup === 'preauth') {\n      const queryKey = query && Object.keys(query)[0];\n\n      if (!['email', 'emailhash', 'userId', 'orgId', 'mode'].includes(queryKey)) {\n        return Promise.reject(\n          new Error('a query param of email, emailhash, userId, orgId, or mode is required')\n        );\n      }\n    }\n    // encode email when query key is email\n    if (serviceGroup === 'preauth' || serviceGroup === 'signin') {\n      const queryKey = Object.keys(query)[0];\n\n      formattedQuery = {};\n\n      if (queryKey === 'email' && query.email) {\n        formattedQuery.emailhash = sha256(query.email.toLowerCase()).toString();\n      } else {\n        formattedQuery[queryKey] = query[queryKey];\n      }\n    }\n\n    return this._fetchNewServiceHostmap({\n      from,\n      token,\n      query: formattedQuery,\n      forceRefresh,\n    })\n      .then((serviceHostMap) => {\n        catalog.updateServiceUrls(serviceGroup, serviceHostMap);\n        this.updateCredentialsConfig();\n        catalog.status[serviceGroup].collecting = false;\n      })\n      .catch((error) => {\n        catalog.status[serviceGroup].collecting = false;\n\n        return Promise.reject(error);\n      });\n  },\n\n  /**\n   * User validation parameter transfer object for {@link validateUser}.\n   * @param {object} ValidateUserPTO\n   * @property {string} ValidateUserPTO.email - The email of the user.\n   * @property {string} [ValidateUserPTO.reqId] - The activation requester.\n   * @property {object} [ValidateUserPTO.activationOptions] - Extra options to pass when sending the activation\n   * @property {object} [ValidateUserPTO.preloginUserId] - The prelogin user id to set when sending the activation.\n   */\n\n  /**\n   * User validation return transfer object for {@link validateUser}.\n   * @param {object} ValidateUserRTO\n   * @property {boolean} ValidateUserRTO.activated - If the user is activated.\n   * @property {boolean} ValidateUserRTO.exists - If the user exists.\n   * @property {string} ValidateUserRTO.details - A descriptive status message.\n   * @property {object} ValidateUserRTO.user - **License** service user object.\n   */\n\n  /**\n   * Validate if a user is activated and update the service catalogs as needed\n   * based on the user's activation status.\n   *\n   * @param {ValidateUserPTO} - The parameter transfer object.\n   * @returns {ValidateUserRTO} - The return transfer object.\n   */\n  validateUser({\n    email,\n    reqId = 'WEBCLIENT',\n    forceRefresh = false,\n    activationOptions = {},\n    preloginUserId,\n  }) {\n    this.logger.info('services: validating a user');\n\n    // Validate that an email parameter key was provided.\n    if (!email) {\n      return Promise.reject(new Error('`email` is required'));\n    }\n\n    // Destructure the credentials object.\n    const {canAuthorize} = this.webex.credentials;\n\n    // Validate that the user is already authorized.\n    if (canAuthorize) {\n      return this.updateServices({forceRefresh})\n        .then(() => this.webex.credentials.getUserToken())\n        .then((token) =>\n          this.sendUserActivation({\n            email,\n            reqId,\n            token: token.toString(),\n            activationOptions,\n            preloginUserId,\n          })\n        )\n        .then((userObj) => ({\n          activated: true,\n          exists: true,\n          details: 'user is authorized via a user token',\n          user: userObj,\n        }));\n    }\n\n    // Destructure the client authorization details.\n    /* eslint-disable camelcase */\n    const {client_id, client_secret} = this.webex.credentials.config;\n\n    // Validate that client authentication details exist.\n    if (!client_id || !client_secret) {\n      return Promise.reject(new Error('client authentication details are not available'));\n    }\n    /* eslint-enable camelcase */\n\n    // Declare a class-memeber-scoped token for usage within the promise chain.\n    let token;\n\n    // Begin client authentication user validation.\n    return (\n      this.collectPreauthCatalog({email})\n        .then(() => {\n          // Retrieve the service url from the updated catalog. This is required\n          // since `WebexCore` is usually not fully initialized at the time this\n          // request completes.\n          const idbrokerService = this.get('idbroker', true);\n\n          // Collect the client auth token.\n          return this.webex.credentials.getClientToken({\n            uri: `${idbrokerService}idb/oauth2/v1/access_token`,\n            scope: 'webexsquare:admin webexsquare:get_conversation Identity:SCIM',\n          });\n        })\n        .then((tokenObj) => {\n          // Generate the token string.\n          token = tokenObj.toString();\n\n          // Collect the signin catalog using the client auth information.\n          return this.collectSigninCatalog({email, token, forceRefresh});\n        })\n        // Validate if collecting the signin catalog failed and populate the RTO\n        // with the appropriate content.\n        .catch((error) => ({\n          exists: error.name !== 'NotFound',\n          activated: false,\n          details:\n            error.name !== 'NotFound'\n              ? 'user exists but is not activated'\n              : 'user does not exist and is not activated',\n        }))\n        // Validate if the previous promise resolved with an RTO and populate the\n        // new RTO accordingly.\n        .then((rto) =>\n          Promise.all([\n            rto || {\n              activated: true,\n              exists: true,\n              details: 'user exists and is activated',\n            },\n            this.sendUserActivation({\n              email,\n              reqId,\n              token,\n              activationOptions,\n              preloginUserId,\n            }),\n          ])\n        )\n        .then(([rto, user]) => ({...rto, user}))\n        .catch((error) => {\n          const response = {\n            statusCode: error.statusCode,\n            responseText: error.body && error.body.message,\n            body: error.body,\n          };\n\n          return Promise.reject(response);\n        })\n    );\n  },\n\n  /**\n   * Get user meeting preferences (preferred webex site).\n   *\n   * @returns {object} - User Information including user preferrences .\n   */\n  getMeetingPreferences() {\n    return this.request({\n      method: 'GET',\n      service: 'hydra',\n      resource: 'meetingPreferences',\n    })\n      .then((res) => {\n        this.logger.info('services: received user region info');\n\n        return res.body;\n      })\n      .catch((err) => {\n        this.logger.info('services: was not able to fetch user login information', err);\n        // resolve successfully even if request failed\n      });\n  },\n\n  /**\n   * Fetches client region info such as countryCode and timezone.\n   *\n   * @returns {object} - The region info object.\n   */\n  fetchClientRegionInfo() {\n    return this.request({\n      uri: 'https://ds.ciscospark.com/v1/region',\n      addAuthHeader: false,\n      headers: {\n        'spark-user-agent': null,\n      },\n      timeout: 5000,\n    })\n      .then((res) => {\n        this.logger.info('services: received user region info');\n\n        return res.body;\n      })\n      .catch((err) => {\n        this.logger.info('services: was not able to get user region info', err);\n        // resolve successfully even if request failed\n      });\n  },\n\n  /**\n   * User activation parameter transfer object for {@link sendUserActivation}.\n   * @typedef {object} SendUserActivationPTO\n   * @property {string} SendUserActivationPTO.email - The email of the user.\n   * @property {string} SendUserActivationPTO.reqId - The activation requester.\n   * @property {string} SendUserActivationPTO.token - The client auth token.\n   * @property {object} SendUserActivationPTO.activationOptions - Extra options to pass when sending the activation.\n   * @property {object} SendUserActivationPTO.preloginUserId - The prelogin user id to set when sending the activation.\n   */\n\n  /**\n   * Send a request to activate a user using a client token.\n   *\n   * @param {SendUserActivationPTO} - The Parameter transfer object.\n   * @returns {LicenseDTO} - The DTO returned from the **License** service.\n   */\n  sendUserActivation({email, reqId, token, activationOptions, preloginUserId}) {\n    this.logger.info('services: sending user activation request');\n    let countryCode;\n    let timezone;\n\n    // try to fetch client region info first\n    return (\n      this.fetchClientRegionInfo()\n        .then((clientRegionInfo) => {\n          if (clientRegionInfo) {\n            ({countryCode, timezone} = clientRegionInfo);\n          }\n\n          // Send the user activation request to the **License** service.\n          return this.request({\n            service: 'license',\n            resource: 'users/activations',\n            method: 'POST',\n            headers: {\n              accept: 'application/json',\n              authorization: token,\n              'x-prelogin-userid': preloginUserId,\n            },\n            body: {\n              email,\n              reqId,\n              countryCode,\n              timeZone: timezone,\n              ...activationOptions,\n            },\n            shouldRefreshAccessToken: false,\n          });\n        })\n        // On success, return the **License** user object.\n        .then(({body}) => body)\n        // On failure, reject with error from **License**.\n        .catch((error) => Promise.reject(error))\n    );\n  },\n\n  /**\n   * simplified method to update the preauth catalog via email\n   *\n   * @param {object} query\n   * @param {string} query.email - A standard format email.\n   * @param {string} query.orgId - The user's OrgId.\n   * @param {boolean} forceRefresh - Boolean to bypass u2c cache control header\n   * @returns {Promise<void>}\n   */\n  collectPreauthCatalog(query, forceRefresh = false) {\n    if (!query) {\n      return this.updateServices({\n        from: 'limited',\n        query: {mode: 'DEFAULT_BY_PROXIMITY'},\n        forceRefresh,\n      });\n    }\n\n    return this.updateServices({from: 'limited', query, forceRefresh});\n  },\n\n  /**\n   * simplified method to update the signin catalog via email and token\n   * @param {object} param\n   * @param {string} param.email - must be a standard-format email\n   * @param {string} param.token - must be a client token\n   * @returns {Promise<void>}\n   */\n  collectSigninCatalog({email, token, forceRefresh} = {}) {\n    if (!email) {\n      return Promise.reject(new Error('`email` is required'));\n    }\n    if (!token) {\n      return Promise.reject(new Error('`token` is required'));\n    }\n\n    return this.updateServices({\n      from: 'signin',\n      query: {email},\n      token,\n      forceRefresh,\n    });\n  },\n\n  /**\n   * Updates credentials config to utilize u2c catalog\n   * urls.\n   * @returns {void}\n   */\n  updateCredentialsConfig() {\n    const {idbroker, identity} = this.list(true);\n\n    if (idbroker && identity) {\n      const {authorizationString, authorizeUrl} = this.webex.config.credentials;\n\n      // This must be set outside of the setConfig method used to assign the\n      // idbroker and identity url values.\n      this.webex.config.credentials.authorizeUrl = authorizationString\n        ? authorizeUrl\n        : `${idbroker.replace(trailingSlashes, '')}/idb/oauth2/v1/authorize`;\n\n      this.webex.setConfig({\n        credentials: {\n          idbroker: {\n            url: idbroker.replace(trailingSlashes, ''), // remove trailing slash\n          },\n          identity: {\n            url: identity.replace(trailingSlashes, ''), // remove trailing slash\n          },\n        },\n      });\n    }\n  },\n\n  /**\n   * Wait until the service catalog is available,\n   * or reject afte ra timeout of 60 seconds.\n   * @param {string} serviceGroup\n   * @param {number} [timeout] - in seconds\n   * @returns {Promise<void>}\n   */\n  waitForCatalog(serviceGroup, timeout) {\n    const catalog = this._getCatalog();\n    const {supertoken} = this.webex.credentials;\n\n    if (\n      serviceGroup === 'postauth' &&\n      supertoken &&\n      supertoken.access_token &&\n      !catalog.status.postauth.collecting &&\n      !catalog.status.postauth.ready\n    ) {\n      if (!catalog.status.preauth.ready) {\n        return this.initServiceCatalogs();\n      }\n\n      return this.updateServices();\n    }\n\n    return catalog.waitForCatalog(serviceGroup, timeout);\n  },\n\n  /**\n   * Service waiting parameter transfer object for {@link waitForService}.\n   *\n   * @typedef {object} WaitForServicePTO\n   * @property {string} [WaitForServicePTO.name] - The service name.\n   * @property {string} [WaitForServicePTO.url] - The service url.\n   * @property {string} [WaitForServicePTO.timeout] - wait duration in seconds.\n   */\n\n  /**\n   * Wait until the service has been ammended to any service catalog. This\n   * method prioritizes the service name over the service url when searching.\n   *\n   * @param {WaitForServicePTO} - The parameter transfer object.\n   * @returns {Promise<string>} - Resolves to the priority host of a service.\n   */\n  waitForService({name, timeout = 5, url}) {\n    const {services} = this.webex.config;\n\n    // Save memory by grabbing the catalog after there isn't a priortyURL\n    const catalog = this._getCatalog();\n\n    const fetchFromServiceUrl = services.servicesNotNeedValidation.find(\n      (service) => service === name\n    );\n\n    if (fetchFromServiceUrl) {\n      return Promise.resolve(this._serviceUrls[name]);\n    }\n\n    const priorityUrl = this.get(name, true);\n    const priorityUrlObj = this.getServiceFromUrl(url);\n\n    if (priorityUrl || priorityUrlObj) {\n      return Promise.resolve(priorityUrl || priorityUrlObj.priorityUrl);\n    }\n\n    if (catalog.isReady) {\n      if (url) {\n        return Promise.resolve(url);\n      }\n\n      this.webex.internal.metrics.submitClientMetrics(METRICS.JS_SDK_SERVICE_NOT_FOUND, {\n        fields: {service_name: name},\n      });\n\n      return Promise.reject(\n        new Error(`services: service '${name}' was not found in any of the catalogs`)\n      );\n    }\n\n    return new Promise((resolve, reject) => {\n      const groupsToCheck = ['preauth', 'signin', 'postauth'];\n      const checkCatalog = (catalogGroup) =>\n        catalog\n          .waitForCatalog(catalogGroup, timeout)\n          .then(() => {\n            const scopedPriorityUrl = this.get(name, true);\n            const scopedPrioriryUrlObj = this.getServiceFromUrl(url);\n\n            if (scopedPriorityUrl || scopedPrioriryUrlObj) {\n              resolve(scopedPriorityUrl || scopedPrioriryUrlObj.priorityUrl);\n            }\n          })\n          .catch(() => undefined);\n\n      Promise.all(groupsToCheck.map((group) => checkCatalog(group))).then(() => {\n        this.webex.internal.metrics.submitClientMetrics(METRICS.JS_SDK_SERVICE_NOT_FOUND, {\n          fields: {service_name: name},\n        });\n        reject(new Error(`services: service '${name}' was not found after waiting`));\n      });\n    });\n  },\n\n  /**\n   * @private\n   * Organize a received hostmap from a service\n   * catalog endpoint.\n   * @param {object} serviceHostmap\n   * @returns {object}\n   */\n  _formatReceivedHostmap(serviceHostmap) {\n    // map the host catalog items to a formatted hostmap\n    const formattedHostmap = Object.keys(serviceHostmap.hostCatalog).reduce((accumulator, key) => {\n      if (serviceHostmap.hostCatalog[key].length === 0) {\n        return accumulator;\n      }\n\n      const serviceName = serviceHostmap.hostCatalog[key][0].id.split(':')[3];\n      const defaultUrl = serviceHostmap.serviceLinks[serviceName];\n\n      let serviceItem = accumulator.find((item) => item.name === serviceName);\n\n      if (!serviceItem) {\n        serviceItem = {\n          name: serviceName,\n          defaultUrl,\n          defaultHost: Url.parse(defaultUrl).hostname,\n          hosts: [],\n        };\n\n        accumulator.push(serviceItem);\n      }\n\n      serviceItem.hosts.push(\n        // map the default key as a low priority default for cluster matching\n        {\n          host: key,\n          ttl: -1,\n          priority: 10,\n          id: serviceHostmap.hostCatalog[key][0].id,\n          homeCluster: serviceItem.defaultHost === key,\n        },\n        // map the rest of the hosts in their proper locations\n        ...serviceHostmap.hostCatalog[key].map((host) => ({\n          ...host,\n          homeCluster: serviceItem.defaultHost === key,\n        }))\n      );\n\n      return accumulator;\n    }, []);\n\n    // append service links that do not exist in the host catalog\n    Object.keys(serviceHostmap.serviceLinks).forEach((key) => {\n      const service = formattedHostmap.find((item) => item.name === key);\n\n      if (!service) {\n        formattedHostmap.push({\n          name: key,\n          defaultUrl: serviceHostmap.serviceLinks[key],\n          defaultHost: Url.parse(serviceHostmap.serviceLinks[key]).hostname,\n          hosts: [],\n        });\n      }\n    });\n\n    // update all the service urls in the host catalog\n\n    this._updateServiceUrls(serviceHostmap.serviceLinks);\n\n    return formattedHostmap;\n  },\n\n  /**\n   * Get the clusterId associated with a URL string.\n   * @param {string} url\n   * @returns {string} - Cluster ID of url provided\n   */\n  getClusterId(url) {\n    const catalog = this._getCatalog();\n\n    return catalog.findClusterId(url);\n  },\n\n  /**\n   * Get a service value from a provided clusterId. This method will\n   * return an object containing both the name and url of a found service.\n   * @param {object} params\n   * @param {string} params.clusterId - clusterId of found service\n   * @param {boolean} [params.priorityHost] - returns priority host url if true\n   * @param {string} [params.serviceGroup] - specify service group\n   * @returns {object} service\n   * @returns {string} service.name\n   * @returns {string} service.url\n   */\n  getServiceFromClusterId(params) {\n    const catalog = this._getCatalog();\n\n    return catalog.findServiceFromClusterId(params);\n  },\n\n  /**\n   * Get a service object from a service url if the service url exists in the\n   * catalog.\n   *\n   * @param {string} url - The url to be validated.\n   * @returns {object} - Service object.\n   * @returns {object.name} - The name of the service found.\n   * @returns {object.priorityUrl} - The priority url of the found service.\n   * @returns {object.defaultUrl} - The default url of the found service.\n   */\n  getServiceFromUrl(url = '') {\n    const service = this._getCatalog().findServiceUrlFromUrl(url);\n\n    if (!service) {\n      return undefined;\n    }\n\n    return {\n      name: service.name,\n      priorityUrl: service.get(true),\n      defaultUrl: service.get(),\n    };\n  },\n\n  /**\n   * Verify that a provided url exists in the service\n   * catalog.\n   * @param {string} url\n   * @returns {boolean} - true if exists, false otherwise\n   */\n  isServiceUrl(url) {\n    const catalog = this._getCatalog();\n\n    return !!catalog.findServiceUrlFromUrl(url);\n  },\n\n  /**\n   * Determine if a provided url is in the catalog's allowed domains.\n   *\n   * @param {string} url - The url to match allowed domains against.\n   * @returns {boolean} - True if the url provided is allowed.\n   */\n  isAllowedDomainUrl(url) {\n    const catalog = this._getCatalog();\n\n    return !!catalog.findAllowedDomain(url);\n  },\n\n  /**\n   * Converts the host portion of the url from default host\n   * to a priority host\n   *\n   * @param {string} url a service url that contains a default host\n   * @returns {string} a service url that contains the top priority host.\n   * @throws if url isn't a service url\n   */\n  convertUrlToPriorityHostUrl(url = '') {\n    const data = this.getServiceFromUrl(url);\n\n    if (!data) {\n      throw Error(`No service associated with url: [${url}]`);\n    }\n\n    return url.replace(data.defaultUrl, data.priorityUrl);\n  },\n\n  /**\n   * @private\n   * Simplified method wrapper for sending a request to get\n   * an updated service hostmap.\n   * @param {object} [param]\n   * @param {string} [param.from] - This accepts `limited` or `signin`\n   * @param {object} [param.query] - This accepts `email`, `orgId` or `userId` key values\n   * @param {string} [param.query.email] - must be a standard-format email\n   * @param {string} [param.query.orgId] - must be an organization id\n   * @param {string} [param.query.userId] - must be a user id\n   * @param {string} [param.token] - used for signin catalog\n   * @returns {Promise<object>}\n   */\n  _fetchNewServiceHostmap({from, query, token, forceRefresh} = {}) {\n    const service = 'u2c';\n    const resource = from ? `/${from}/catalog` : '/catalog';\n    const qs = {...query, format: 'hostmap'};\n\n    if (forceRefresh) {\n      qs.timestamp = new Date().getTime();\n    }\n\n    const requestObject = {\n      method: 'GET',\n      service,\n      resource,\n      qs,\n    };\n\n    if (token) {\n      requestObject.headers = {authorization: token};\n    }\n\n    return this.request(requestObject).then(({body}) => this._formatReceivedHostmap(body));\n  },\n\n  /**\n   * Initialize the discovery services and the whitelisted services.\n   *\n   * @returns {void}\n   */\n  initConfig() {\n    // Get the catalog and destructure the services config.\n    const catalog = this._getCatalog();\n    const {services, fedramp} = this.webex.config;\n\n    // Validate that the services configuration exists.\n    if (services) {\n      if (fedramp) {\n        services.discovery = fedRampServices;\n      }\n      // Check for discovery services.\n      if (services.discovery) {\n        // Format the discovery configuration into an injectable array.\n        const formattedDiscoveryServices = Object.keys(services.discovery).map((key) => ({\n          name: key,\n          defaultUrl: services.discovery[key],\n        }));\n\n        // Inject formatted discovery services into services catalog.\n        catalog.updateServiceUrls('discovery', formattedDiscoveryServices);\n      }\n\n      if (services.override) {\n        // Format the override configuration into an injectable array.\n        const formattedOverrideServices = Object.keys(services.override).map((key) => ({\n          name: key,\n          defaultUrl: services.override[key],\n        }));\n\n        // Inject formatted override services into services catalog.\n        catalog.updateServiceUrls('override', formattedOverrideServices);\n      }\n\n      // Check for allowed host domains.\n      if (services.allowedDomains) {\n        // Store the allowed domains as a property of the catalog.\n        catalog.setAllowedDomains(services.allowedDomains);\n      }\n\n      // Set `validateDomains` property to match configuration\n      this.validateDomains = services.validateDomains;\n    }\n  },\n\n  /**\n   * Make the initial requests to collect the root catalogs.\n   *\n   * @returns {Promise<void, Error>} - Errors if the token is unavailable.\n   */\n  initServiceCatalogs() {\n    this.logger.info('services: initializing initial service catalogs');\n\n    // Destructure the credentials plugin.\n    const {credentials} = this.webex;\n\n    // Init a promise chain. Must be done as a Promise.resolve() to allow\n    // credentials#getOrgId() to properly throw.\n    return (\n      Promise.resolve()\n        // Get the user's OrgId.\n        .then(() => credentials.getOrgId())\n        // Begin collecting the preauth/limited catalog.\n        .then((orgId) => this.collectPreauthCatalog({orgId}))\n        .then(() => {\n          // Validate if the token is authorized.\n          if (credentials.canAuthorize) {\n            // Attempt to collect the postauth catalog.\n            return this.updateServices().catch(() =>\n              this.logger.warn('services: cannot retrieve postauth catalog')\n            );\n          }\n\n          // Return a resolved promise for consistent return value.\n          return Promise.resolve();\n        })\n    );\n  },\n\n  /**\n   * Initializer\n   *\n   * @instance\n   * @memberof Services\n   * @returns {Services}\n   */\n  initialize() {\n    const catalog = new ServiceCatalog();\n    const registry = new ServiceRegistry();\n    const state = new ServiceState();\n\n    this._catalogs.set(this.webex, catalog);\n    this.registries.set(this.webex, registry);\n    this.states.set(this.webex, state);\n\n    // Listen for configuration changes once.\n    this.listenToOnce(this.webex, 'change:config', () => {\n      this.initConfig();\n    });\n\n    // wait for webex instance to be ready before attempting\n    // to update the service catalogs\n    this.listenToOnce(this.webex, 'ready', () => {\n      const {supertoken} = this.webex.credentials;\n\n      // Validate if the supertoken exists.\n      if (supertoken && supertoken.access_token) {\n        this.initServiceCatalogs()\n          .then(() => {\n            catalog.isReady = true;\n          })\n          .catch((error) =>\n            this.logger.error(`services: failed to init initial services, ${error.message}`)\n          );\n      } else {\n        const {email} = this.webex.config;\n\n        this.collectPreauthCatalog(email ? {email} : undefined);\n      }\n    });\n  },\n});\n/* eslint-enable no-underscore-dangle */\n\nexport default Services;\n"],"mappings":"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"}