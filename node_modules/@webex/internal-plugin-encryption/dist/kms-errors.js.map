{"version":3,"names":["_common","require","_webexCore","_createSuper","Derived","hasNativeReflectConstruct","_isNativeReflectConstruct","_createSuperInternal","Super","_getPrototypeOf2","default","result","NewTarget","constructor","_Reflect$construct","arguments","apply","_possibleConstructorReturn2","Reflect","sham","Proxy","Boolean","prototype","valueOf","call","e","KmsError","_Exception","_inherits2","_super","_classCallCheck2","_createClass2","key","value","parse","body","_defineProperties","enumerable","reason","requestId","status","message","defaultMessage","concat","Exception","exports","_defineProperty2","KmsTimeoutError","_KmsError","_super2","_ref","length","undefined","_ref$request","request","timeout","method","uri","DryError","_WebexHttpError","_super3","_apply","WebexHttpError","_res","options","url","service","toUpperCase","resource","headers","trackingid"],"sources":["kms-errors.js"],"sourcesContent":["/*!\n * Copyright (c) 2015-2020 Cisco Systems, Inc. See LICENSE file.\n */\n\nimport {Exception} from '@webex/common';\nimport {WebexHttpError} from '@webex/webex-core';\n\n/**\n * Error class for KMS errors\n */\nexport class KmsError extends Exception {\n  static defaultMessage =\n    'An unknown error occurred while communicating with the kms. This implies we received an error response without a body.';\n\n  /**\n   * @param {HttpResponse} body\n   * @returns {string}\n   */\n  parse(body) {\n    body = body.body || body;\n\n    Object.defineProperties(this, {\n      body: {\n        enumerable: false,\n        value: body,\n      },\n      reason: {\n        enumerable: false,\n        value: body.reason,\n      },\n      requestId: {\n        enumerable: false,\n        value: body.requestId,\n      },\n      status: {\n        enumerable: false,\n        value: body.status,\n      },\n    });\n\n    let message = typeof body === 'string' ? body : body.reason;\n\n    if (!message) {\n      message = this.constructor.defaultMessage;\n    }\n    if (body.status) {\n      message += `\\nKMS_RESPONSE_STATUS: ${body.status}`;\n    }\n    if (body.requestId) {\n      message += `\\nKMS_REQUEST_ID: ${body.requestId}`;\n    }\n\n    return message;\n  }\n}\n\n/**\n * Thrown when an expected KMSResponse is not received in a timely manner\n */\nexport class KmsTimeoutError extends KmsError {\n  /**\n   * @param {KmsRequest} options.request\n   * @param {KmsRequest} options.timeout\n   * @returns {string}\n   */\n  parse({request = {}, timeout} = {}) {\n    let message = `The KMS did not respond within ${\n      timeout ? `${timeout} milliseconds` : 'a timely fashion'\n    }`;\n\n    if (request) {\n      if (request.method && request.uri) {\n        message += `\\nKMS_REQUEST: ${request.method} ${request.uri}`;\n      }\n\n      if (request.requestId) {\n        message += `\\nKMS_REQUEST_ID: ${request.requestId}`;\n      }\n    }\n\n    return message;\n  }\n}\n\n/**\n * Emitted when a REST request includes an encrypter error\n */\nexport class DryError extends WebexHttpError {\n  static defaultMessage = 'An unknown error was received from a service that proxies to the KMS';\n\n  /**\n   * @param {WebexHttpError} reason\n   * @returns {string}\n   */\n  parse(reason) {\n    Reflect.apply(WebexHttpError.prototype.parse, this, [reason._res]);\n    const body = reason._res.body.message;\n\n    let message = body.reason || body;\n\n    if (!message) {\n      message = this.constructor.defaultMessage;\n    }\n    if (this.options.url) {\n      message += `\\n${this.options.method} ${this.options.url}`;\n    } else if (this.options.uri) {\n      message += `\\n${this.options.method} ${this.options.uri}`;\n    } else {\n      message += `\\n${this.options.method} ${this.options.service.toUpperCase()}/${\n        this.options.resource\n      }`;\n    }\n    message += `\\nWEBEX_TRACKING_ID: ${this.options.headers.trackingid}`;\n\n    if (body.status) {\n      message += `\\nKMS_RESPONSE_STATUS: ${body.status}`;\n    }\n    if (body.requestId) {\n      message += `\\nKMS_REQUEST_ID: ${body.requestId}`;\n    }\n\n    Object.defineProperties(this, {\n      reason: {\n        enumerable: false,\n        value: body.reason,\n      },\n      requestId: {\n        enumerable: false,\n        value: body.requestId,\n      },\n      status: {\n        enumerable: false,\n        value: body.status,\n      },\n    });\n\n    return message;\n  }\n}\n"],"mappings":"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"}